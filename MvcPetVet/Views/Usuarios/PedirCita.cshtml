@{
    Layout = "_TemplateUser";
    ViewData["Title"] = "Pedir Cita";
}

<div class="page-title">
    <div class="row justify-content-between align-items-center">
        <div class="col-md-4 mb-3 mb-md-0">
            <h5 class="h3 font-weight-400 mb-0 text-white">Calendario de citas</h5>
        </div>
    </div>
</div>
<div class="container">
    <div class="card border">
        <div class="text-center" style="padding:10px">
            <form method="post" >
                <div class="form-group">
                    <label class="control-label"></label>
                    <input type="date" name="fecha" class="form-control" id="cita_fecha">
                </div>
                <div class="form-group">
                    <select id="cita_hora">

                    </select>
                </div>

                <div class="form-group">
                    <input type="submit" value="Create" class="btn btn-primary" />
                </div>
            </form>
        </div>
    </div>
</div>

@if (ViewData["FECHA"] != null)
{
    <h1>@ViewData["FECHA"]</h1>
}


@section Scripts
    {
    <script>
        $(document).ready(function() {
            // obtén los elementos de fecha y hora
            var fechaInput = $('#cita_fecha');
            var horaSelect = $('#cita_hora');
            

            // define una función para agregar opciones al select de hora
                function agregarOpcionesDeHora(min, max) {
                    // obtén la fecha seleccionada
                    var fechaSeleccionada = fechaInput.val();

                    // crea una fecha a partir del valor seleccionado
                    var fecha = new Date(fechaSeleccionada);

                    // elimina las opciones existentes en el select
                    horaSelect.empty();

                    // agrega opciones desde las 10:00 hasta las 20:00
                    for (var hora = min; hora < max; hora++) {
                    for (var minuto = 0; minuto < 60; minuto += 15) {
                        // crea una fecha con la hora actual
                        var fechaHora = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), hora, minuto);

                        // convierte la fecha a una cadena en formato "hh:mm"
                        var horaTexto = fechaHora.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'});

                        // agrega la opción al select
                        horaSelect.append($('<option>', {
                        value: horaTexto,
                        text: horaTexto
                        }));
                    }
                    }
                }

            // registra un evento de cambio en el campo de fecha
            fechaInput.change(function() {

            var min = 10;
            var max = 20;

            // obtén el valor de la fecha
                var fechaTexto = fechaInput.val();

                // crea una fecha a partir del valor seleccionado
                var fecha = new Date(fechaTexto);

                // obtén el nombre del día de la semana (por ejemplo, "Monday")
                var diaDeLaSemana = fecha.toLocaleDateString('es-ES', {weekday: 'long'});

                if(diaDeLaSemana == 'domingo') {
                                max = 14;
                                min = 11;
                    } else if(diaDeLaSemana == 'sábado') {
                                max = 14;
                    } 

                agregarOpcionesDeHora(min, max);

            // cuando la fecha cambia, agrega opciones al select de hora
            
            });
        });
    </script>
}
